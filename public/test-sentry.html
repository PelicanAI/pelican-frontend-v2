<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Pelican - Sentry Integration Test</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 20px;
    }
    
    .container {
      background: white;
      border-radius: 12px;
      box-shadow: 0 20px 60px rgba(0,0,0,0.3);
      padding: 40px;
      max-width: 600px;
      width: 100%;
    }
    
    h1 {
      color: #333;
      margin-bottom: 10px;
      font-size: 28px;
    }
    
    .subtitle {
      color: #666;
      margin-bottom: 30px;
      font-size: 14px;
    }
    
    .test-section {
      margin-bottom: 20px;
      padding: 20px;
      background: #f8f9fa;
      border-radius: 8px;
      border-left: 4px solid #667eea;
    }
    
    .test-section h2 {
      font-size: 18px;
      color: #333;
      margin-bottom: 10px;
    }
    
    .test-section p {
      color: #666;
      font-size: 14px;
      margin-bottom: 15px;
      line-height: 1.5;
    }
    
    button {
      background: #667eea;
      color: white;
      border: none;
      padding: 12px 24px;
      border-radius: 6px;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
      margin-right: 10px;
      margin-bottom: 10px;
    }
    
    button:hover {
      background: #5568d3;
      transform: translateY(-1px);
      box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
    }
    
    button:active {
      transform: translateY(0);
    }
    
    .result {
      margin-top: 15px;
      padding: 12px;
      border-radius: 6px;
      font-size: 13px;
      font-family: 'Monaco', 'Courier New', monospace;
      display: none;
    }
    
    .result.success {
      background: #d4edda;
      color: #155724;
      border: 1px solid #c3e6cb;
      display: block;
    }
    
    .result.error {
      background: #f8d7da;
      color: #721c24;
      border: 1px solid #f5c6cb;
      display: block;
    }
    
    .result.info {
      background: #d1ecf1;
      color: #0c5460;
      border: 1px solid #bee5eb;
      display: block;
    }
    
    pre {
      margin-top: 10px;
      white-space: pre-wrap;
      word-wrap: break-word;
      font-size: 12px;
    }
    
    .status-indicator {
      display: inline-block;
      width: 8px;
      height: 8px;
      border-radius: 50%;
      margin-right: 8px;
    }
    
    .status-indicator.pending {
      background: #ffc107;
    }
    
    .status-indicator.success {
      background: #28a745;
    }
    
    .status-indicator.error {
      background: #dc3545;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>üîç Sentry Integration Test</h1>
    <p class="subtitle">Test your Pelican Sentry error tracking setup</p>
    
    <!-- Test 1: Health Check -->
    <div class="test-section">
      <h2><span class="status-indicator pending" id="status-1"></span>Test 1: Health Check</h2>
      <p>Verify that Sentry is configured and accessible</p>
      <button onclick="testHealthCheck()">Run Health Check</button>
      <div id="result-1" class="result"></div>
    </div>
    
    <!-- Test 2: Send Test Error -->
    <div class="test-section">
      <h2><span class="status-indicator pending" id="status-2"></span>Test 2: Backend Error Capture</h2>
      <p>Trigger a test error from the backend to verify Sentry receives it</p>
      <button onclick="testSendError()">Send Test Error</button>
      <div id="result-2" class="result"></div>
    </div>
    
    <!-- Test 3: Client Error -->
    <div class="test-section">
      <h2><span class="status-indicator pending" id="status-3"></span>Test 3: Client-Side Error</h2>
      <p>Trigger a client-side error to test browser-side Sentry integration</p>
      <button onclick="testClientError()">Trigger Client Error</button>
      <div id="result-3" class="result"></div>
    </div>
    
    <!-- Test 4: Run All Tests -->
    <div class="test-section">
      <button onclick="runAllTests()" style="background: #28a745;">Run All Tests</button>
    </div>
  </div>
  
  <script>
    async function testHealthCheck() {
      const statusEl = document.getElementById('status-1');
      const resultEl = document.getElementById('result-1');
      
      statusEl.className = 'status-indicator pending';
      resultEl.textContent = 'Running health check...';
      resultEl.className = 'result info';
      
      try {
        const response = await fetch('/api/monitoring/sentry');
        const data = await response.json();
        
        if (data.status === 'healthy') {
          statusEl.className = 'status-indicator success';
          resultEl.className = 'result success';
          resultEl.innerHTML = `‚úÖ Sentry is healthy!<pre>${JSON.stringify(data, null, 2)}</pre>`;
        } else {
          statusEl.className = 'status-indicator error';
          resultEl.className = 'result error';
          resultEl.innerHTML = `‚ùå Sentry health check failed<pre>${JSON.stringify(data, null, 2)}</pre>`;
        }
      } catch (error) {
        statusEl.className = 'status-indicator error';
        resultEl.className = 'result error';
        resultEl.textContent = `‚ùå Error: ${error.message}`;
      }
    }
    
    async function testSendError() {
      const statusEl = document.getElementById('status-2');
      const resultEl = document.getElementById('result-2');
      
      statusEl.className = 'status-indicator pending';
      resultEl.textContent = 'Sending test error to Sentry...';
      resultEl.className = 'result info';
      
      try {
        const response = await fetch('/api/monitoring/sentry', { method: 'POST' });
        const data = await response.json();
        
        if (response.ok) {
          statusEl.className = 'status-indicator success';
          resultEl.className = 'result success';
          resultEl.innerHTML = `‚úÖ Test error sent successfully!<pre>${JSON.stringify(data, null, 2)}</pre>
          <p style="margin-top: 10px; font-style: italic;">Check your Sentry dashboard to see the error.</p>`;
        } else {
          statusEl.className = 'status-indicator error';
          resultEl.className = 'result error';
          resultEl.innerHTML = `‚ùå Failed to send test error<pre>${JSON.stringify(data, null, 2)}</pre>`;
        }
      } catch (error) {
        statusEl.className = 'status-indicator error';
        resultEl.className = 'result error';
        resultEl.textContent = `‚ùå Error: ${error.message}`;
      }
    }
    
    function testClientError() {
      const statusEl = document.getElementById('status-3');
      const resultEl = document.getElementById('result-3');
      
      statusEl.className = 'status-indicator pending';
      resultEl.textContent = 'Triggering client-side error...';
      resultEl.className = 'result info';
      
      try {
        // Check if Sentry is available
        if (typeof window.Sentry === 'undefined') {
          statusEl.className = 'status-indicator error';
          resultEl.className = 'result error';
          resultEl.innerHTML = `‚ùå Sentry is not loaded on the client side.<br>
          <small>Note: Sentry may only be available within the Next.js app, not on static HTML pages.</small>`;
          return;
        }
        
        // Trigger a test error
        const testError = new Error('Client-side test error from Sentry test page');
        window.Sentry.captureException(testError, {
          tags: { source: 'test-page', type: 'client-test' }
        });
        
        statusEl.className = 'status-indicator success';
        resultEl.className = 'result success';
        resultEl.innerHTML = `‚úÖ Client-side error triggered!<br>
        <small>Check your Sentry dashboard to verify it was received.</small>`;
      } catch (error) {
        statusEl.className = 'status-indicator error';
        resultEl.className = 'result error';
        resultEl.textContent = `‚ùå Error: ${error.message}`;
      }
    }
    
    async function runAllTests() {
      await testHealthCheck();
      await new Promise(resolve => setTimeout(resolve, 500));
      await testSendError();
      await new Promise(resolve => setTimeout(resolve, 500));
      testClientError();
    }
  </script>
</body>
</html>

